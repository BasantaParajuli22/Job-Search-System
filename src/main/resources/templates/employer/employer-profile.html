<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Profile</title>
    <link rel="stylesheet" th:href="@{/css/navbar-footer.css}">
    <link rel="stylesheet" th:href="@{/css/profile.css}">
    <link rel="stylesheet" th:href="@{/css/post-style.css}">
    <style>
        /* Add this style inside the <style> tag */
        .website-link {
            display: inline-block; /* Important to make width work */
            max-width: 250px; /* Adjust this to fit your layout */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            word-break: break-all; /* For very long words */
        }
         .job-post-wrapper {
            margin: 20px 0; /* Adds vertical space */
            padding: 0 10px; /* remove padding from all sides and use left padding for alignment */
        }
         @media (max-width: 768px) {
            .website-link {
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <header th:replace="~{fragments/nav :: nav}"></header>

    <main class="main-content">
       <div class="profile-container">
            <h1>Profile: <span th:text="${employer.companyName}"></span></h1>

            <section class="profile-section">
                <h2>Company Information</h2>
                <div class="info-grid">
                    <div>
                        <label><strong>Company Name:</strong></label>
                        <span th:text="${employer.companyName}"></span>
                    </div>
                    <div>
                        <label><strong>Contact Number:</strong></label>
                        <span th:text="${employer.number}"></span>
                    </div>
                     <div>
                        <label><strong>Address:</strong></label>
                        <span th:text="${employer.address}"></span>
                    </div>
                    <div th:if="${not #strings.isEmpty(employer.website)}">
                         <label><strong>Website:</strong></label>
                        <a th:href="${employer.website}" target="_blank" th:text="${employer.website}" class="website-link"></a>
                    </div>
                    <div>
                        <label><strong>Created At:</strong></label>
                        <span th:text="${#temporals.format(employer.createdAt, 'dd-MM-yyyy')}"></span>
                    </div>
                </div>
            </section>

            <section class="profile-section">
                <h2>Company Description</h2>
                <div>
                    <label><strong>Description:</strong></label>
                    <p th:text="${employer.companyDescription}"></p>
                </div>
            </section>

            <section class="profile-section">
                <h2>Company Logo</h2>
                <div class="documents-grid">
                    <div class="profile-box" th:if="${not #strings.isEmpty(employer.companyLogoPath)}">
                        <img th:src="@{/view/application/file/{fileName}(fileName=${employer.companyLogoPath})}"
                            alt="Company Logo" class="profile-picture"/>
                        <p>Company Logo</p>
                        <form method="post"
                              th:if="${loggedInEmployer != null and loggedInEmployer.employerId == employer.employerId }"
                              th:action="@{/employers/profile/edit/{employerId}/company-logo(employerId=${employer.employerId})}"
                              enctype="multipart/form-data">
                            <input type="file" name="image" accept=".png, .jpg, .jpeg, .webp" onchange="validateFileSize(this)"/>
                            <button type="submit" onclick="return confirmChangeLogo()">Change Logo</button>
                        </form>
                    </div>

                    <div class="profile-box" th:if="${#strings.isEmpty(employer.companyLogoPath)}">
                        <p>No Company logo added</p>
                        <form method="post"
                              th:if="${loggedInEmployer != null and loggedInEmployer.employerId == employer.employerId }"
                              th:action="@{/employers/profile/edit/{employerId}/company-logo(employerId=${employer.employerId})}"
                              enctype="multipart/form-data">
                            <input type="file" name="image" accept=".png, .jpg, .jpeg, .webp" onchange="validateFileSize(this)"/>
                            <button type="submit">Add Logo</button>
                        </form>
                    </div>

                </div>
            </section>

            <section class="profile-section" th:if="${loggedInEmployer != null }">
                <h2>My Actions</h2>
                <div class="link-group">
                    <a href="/jobposts/new/create">Create New Job Post</a>
                    <a th:href="@{/employers/profile/edit/{employerId}(employerId=${employer.employerId})}">Edit Profile</a>
                </div>
            </section>
        </div>
          <div class="job-post-wrapper">
               <div class="main-container">
                    <div class="job-posts">
                        <h2>Job Posts</h2>
                        <div th:if="${myJobPosts.isEmpty()}">
                            <p>No job posts available for this employer.</p>
                        </div>
                        <div th:unless="${myJobPosts.isEmpty()}" >
                            <div class="job-post-grid">
                                <div th:each="jobPost, iterStat : ${myJobPosts}" class="job-post">
                                    <div class="job-info">
                                        <div class="truncate-text">
                                            <strong>Company Name:</strong>
                                            <span><a th:href="@{/view/jobposts/{jobId}/of/employer/{employerId}(jobId=${jobPost.jobId},employerId=${jobPost.employer.employerId})}" th:text="${jobPost.employer.companyName}"></a></span>
                                        </div>
                                        <div class="truncate-text">
                                            <strong>Title:</strong>
                                            <span><a th:href="@{/view/jobposts/details/{jobId}(jobId=${jobPost.jobId})}" th:text="${jobPost.title}"></a></span>
                                        </div>
                                        <div class="truncate-text">
                                            <strong>Requirements:</strong>
                                            <span th:text="${jobPost.requirements}"></span>
                                        </div>
                                        <div class="truncate-text">
                                            <strong>Job Description:</strong>
                                            <span th:text="${jobPost.jobDescription}"></span>
                                        </div>
                                        <div class="truncate-text">
                                            <strong>Salary Range:</strong>
                                            <span th:text="${jobPost.salaryRange}"></span>
                                        </div>
                                        <strong>Category:</strong> <span th:text="${jobPost.jobCategory}"></span><br>
                                        <strong>Location:</strong> <span th:text="${jobPost.cityLocation}"></span><br>
                                        <strong>Job Type:</strong> <span th:text="${jobPost.jobType}"></span><br>
                                        <strong>Experience Level:</strong> <span th:text="${jobPost.experienceLevel}"></span><br>
                                        <strong>Application Deadline:</strong> <span th:text="${jobPost.applicationDeadline}"></span><br>
                                    </div>

                                    <div class="job-actions">
                                        <div class="app-count">
                                            <p><strong>Total Applications:</strong>
                                                <span th:text="${jobAppCount != null ? jobAppCount[iterStat.index] : 0}"></span>
                                            </p>
                                            <p th:if="${loggedInEmployer != null}">
                                                <a th:href="@{/view/applications/submittedto/employer/{employerId}/of/{jobId}(employerId=${employer.employerId},jobId=${jobPost.jobId})}">
                                                    <button type="button" class="button-green">View Applications</button>
                                                </a>
                                            </p>
                                        </div>

                                        <div class="buttons">
                                            <a th:href="@{/view/jobposts/details/{jobId}(jobId=${jobPost.jobId})}">
                                                <button type="button" class="buttonSmall">View</button>
                                            </a>

                                            <div th:if="${loggedInEmployer != null and loggedInEmployer.employerId == jobPost.employer.employerId}"
                                                 class="edit-delete-buttons">
                                                <form th:action="@{/jobposts/{jobId}/edit/by/{employerId}(jobId=${jobPost.jobId},employerId=${jobPost.employer.employerId})}"
                                                      method="get" style="display:inline;">
                                                    <button type="submit" class="buttonSmall">Edit</button>
                                                </form>

                                                <form th:action="@{/jobposts/{jobId}/delete/byemployer(jobId=${jobPost.jobId})}"
                                                      method="post" style="display:inline;">
                                                    <input type="hidden" th:name="${_csrf.parameterName}"
                                                           th:value="${_csrf.token}"/>
                                                    <button type="submit" class="btn-danger"
                                                            onclick="return confirmDelete()">Delete
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
          </div>
    </main>
  <script>
        function validateFileSize(input) {
            const file = input.files[0];
            if (file && file.size > 1 * 1024 * 1024) { // 1 MB limit
                alert("File size exceeds the maximum allowed size of 1 MB.");
                input.value = ""; // Clear the input
            }
        }

        function confirmChangeLogo() {
            return confirm("Are you sure you want to change your company logo? \n The current logo will be removed!!");
        }

        function confirmDelete() {
            return confirm("Are you sure you want to delete your Job Post permanently?");
        }
    </script>
</body>
</html>